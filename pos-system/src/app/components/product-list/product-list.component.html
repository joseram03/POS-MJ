<div class="grid">
  <div class="col-12">
    <div class="card">
      <div class="flex justify-content-between align-items-center mb-4">
        <h2>Lista de Productos</h2>
        <div class="flex gap-2">
          <app-search-bar (search)="searchProducts($event)"></app-search-bar>
          <p-button icon="pi pi-plus" label="Nuevo" (click)="showDialogToAdd()" styleClass="p-button-success"></p-button>
        </div>
      </div>

      <p-table 
        [value]="products" 
        [paginator]="true" 
        [rows]="rows" 
        [totalRecords]="totalRecords"
        (onPage)="onPageChange($event)" 
        [rowsPerPageOptions]="[5,10,20]"
        [loading]="loading"
        [lazy]="true"
        styleClass="p-datatable-striped"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
            <th pSortableColumn="precio">Precio <p-sortIcon field="precio"></p-sortIcon></th>
            <th pSortableColumn="stock">Stock <p-sortIcon field="stock"></p-sortIcon></th>
            <th>Estado</th>
            <th style="width: 200px">Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-product>
          <tr>
            <td>{{product.nombre}}</td>
            <td>{{product.precio | currency:'Gs ':'symbol':'1.2-2'}}</td>
            <td>{{product.stock}}</td>
            <td>
              <p-tag 
                [value]="product.activo ? 'Activo' : 'Inactivo'" 
                [severity]="product.activo ? 'success' : 'danger'"
              ></p-tag>
            </td>
            <td>
              <div class="flex gap-2">
                <p-button 
                  icon="pi pi-shopping-cart" 
                  (click)="addToCart(product)"
                  tooltip="Agregar al carrito"
                  tooltipPosition="top"
                ></p-button>

              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center">
              No se encontraron productos
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<!-- DiÃ¡logo para agregar/editar productos -->
<p-dialog 
  [(visible)]="displayDialog" 
  [style]="{width: '450px'}" 
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [header]="selectedProduct.id ? 'Editar Producto' : 'Nuevo Producto'"
>
  <div class="p-fluid">
    <div class="field">
      <label for="nombre">Nombre</label>
      <input 
        id="nombre" 
        type="text" 
        pInputText 
        [(ngModel)]="selectedProduct.nombre" 
        required
        placeholder="Ingrese el nombre del producto"
      >
    </div>
    <div class="field">
      <label for="precio">Precio</label>
      <p-inputNumber 
        id="precio" 
        [(ngModel)]="selectedProduct.precio" 
        mode="currency" 
        currency="USD" 
        locale="en-US"
        [min]="0.01"
        [minFractionDigits]="2"
        [maxFractionDigits]="2"
      ></p-inputNumber>
    </div>
    <div class="field">
      <label for="stock">Stock</label>
      <p-inputNumber 
        id="stock" 
        [(ngModel)]="selectedProduct.stock"
        [min]="0"
        [showButtons]="true"
      ></p-inputNumber>
    </div>
    <div class="field" *ngIf="selectedProduct.id">
      <label>Estado</label>
      <p-inputSwitch 
        [(ngModel)]="selectedProduct.activo"
        [disabled]="true"
      ></p-inputSwitch>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button 
      icon="pi pi-times" 
      label="Cancelar" 
      (click)="displayDialog=false"
      styleClass="p-button-text"
    ></p-button>
    <p-button 
      icon="pi pi-check" 
      label="Guardar" 
      (click)="save()"
      [disabled]="!selectedProduct.nombre || !selectedProduct.precio || selectedProduct.precio <= 0"
    ></p-button>
  </ng-template>
</p-dialog>